<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Use of models in SamplingStrata • SamplingStrata</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Use of models in SamplingStrata">
<meta property="og:description" content="SamplingStrata">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-156503236-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-156503236-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SamplingStrata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5-2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/SamplingStrata.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/drake_continuous.html">SamplingStrata workflow with drake</a>
    </li>
    <li>
      <a href="../articles/models.html">Use of models in SamplingStrata</a>
    </li>
    <li>
      <a href="../articles/spatial.html">Spatial sampling with SamplingStrata</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/barcaroli/SamplingStrata/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="models_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Use of models in SamplingStrata</h1>
                        <h4 class="author">Marco Ballin, Giulio Barcaroli</h4>
            
            <h4 class="date">2021-11-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/barcaroli/SamplingStrata/blob/master/vignettes/models.Rmd"><code>vignettes/models.Rmd</code></a></small>
      <div class="hidden name"><code>models.Rmd</code></div>

    </div>

    
    
<div id="handling-anticipated-variance" class="section level1">
<h1 class="hasAnchor">
<a href="#handling-anticipated-variance" class="anchor"></a>Handling Anticipated Variance</h1>
<p>When optimizing the stratification of a sampling frame, values of the target variables Y’s are supposed to be available for the generality of the units in the frame, or at least for a sample of them by means of which it is possible to estimate means and standard deviation of Y’s in atomic strata. Of course, this assumption is seldom expected to hold. The situation in which some proxy variables are available in the frame is much more likely to happen. In these situations, instead of directly indicating the real target variables, proxy ones are named as Y’s. By so doing, there is no guarantee that the final stratification and allocation can ensure the compliance to the set of precision constraints.<br>
In order to take into account this problem, and to limit the risk of overestimating the expected precision levels of the optimized solution, it is possible to carry out the optimization by considering, instead of the expected coefficients of variation related to proxy variables, the anticipated coefficients of variation (ACV) that depend on the model that is possible to fit on couples of real target variables and proxy ones.</p>
<p>In the current implementation, the following restrictions hold:</p>
<ul>
<li>only models linking continuous variables can be considered;</li>
<li>only <em>linear</em> or <em>loglinear</em> models;</li>
<li>only one explanatory variable for each target variable.</li>
</ul>
<p>The definition and the use of these models is the same that has been implemented in the package <em>stratification</em> <span class="citation">(see Baillargeon and Rivest 2014)</span>.</p>
<p>In particular, the reference here is to two different models, the <em>linear model</em> with heteroscedasticity:</p>
<p><span class="math display">\[Z=\beta Y + \epsilon\]</span></p>
<p>where</p>
<p><span class="math display">\[\epsilon \sim N(0,\sigma^2 Y^\gamma)\]</span></p>
<p>(in case <span class="math inline">\(\gamma = 0\)</span>, then the model is homoscedastic)</p>
<p>and the <em>loglinear model</em>:</p>
<p><span class="math display">\[Z= \exp (\beta log(Y) + \epsilon)\]</span></p>
<p>where</p>
<p><span class="math display">\[\epsilon \sim N(0,\sigma^{2})\]</span></p>
<p>In <em>SamplingStrata</em>, the use of models to calculate the anticipated variance implies the execution of the following steps:</p>
<ul>
<li>for each couple <em>target variable Z</em> and <em>available variable in the frame Y</em> fit a model (linear or loglinear) using available data;</li>
<li>in case of linear model, evaluate the heteroscedasticity of residuals (with the function <em>computeGamma</em>);</li>
<li>with the above, define the <em>model</em> dataframe that is given as argument to the <em>optimStrata</em> function.</li>
</ul>
<p>The <em>model</em> dataframe must contain a number of rows equal to the number of the Y variables.The coupling is positional: the first row refers to the Y1, the second row to Y2 and so on.</p>
<p>This is the structure of the <em>model</em> dataframe:</p>
<table class="table">
<thead><tr class="header">
<th>Variable name</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><em>type</em></td>
<td align="left">Can assume one of the two values: <em>linear</em> or <em>loglinear</em>
</td>
</tr>
<tr class="even">
<td><em>beta</em></td>
<td align="left">Contains the value of the <em>beta</em> coefficient in the fitted model</td>
</tr>
<tr class="odd">
<td><em>sig2</em></td>
<td align="left">Contains the value of the <em>model variance</em>.</td>
</tr>
<tr class="even">
<td></td>
<td align="left">It can be the squared value of sigma2 in the fitted model, or (only</td>
</tr>
<tr class="odd">
<td></td>
<td align="left">for linear models) in case of heteroscedasticity it can be</td>
</tr>
<tr class="even">
<td></td>
<td align="left">calculated with the <em>computeGamma</em> function</td>
</tr>
<tr class="odd">
<td><em>gamma</em></td>
<td align="left">Only for linear model: contains the value of the heteroscedasticity</td>
</tr>
<tr class="even">
<td></td>
<td align="left">index (calculated with the <em>computeGamma</em> function)</td>
</tr>
</tbody>
</table>
</div>
<div id="handling-heteroscedasticity-in-linear-models" class="section level1">
<h1 class="hasAnchor">
<a href="#handling-heteroscedasticity-in-linear-models" class="anchor"></a>Handling heteroscedasticity in linear models</h1>
<p>When dealing with <em>linear</em> models, an evaluation of the quantity of heteroscedasticity in the residuals is of the utmost importance in order to correctly evaluate the anticipated variance (see <span class="citation">Henry and Valliant (2006)</span> and <span class="citation">Knaub (2019)</span>). To this aim, a dedicated function has been developed: <em>computeGamma</em>. This function accepts as arguments the following:</p>
<ul>
<li>vector <em>e</em> of <em>residuals</em>;</li>
<li>vector <em>x</em> of the <em>values</em> of the explanatory variable;</li>
<li>number <em>nbins</em> of groups of residuals/values with which to fit a model.</li>
</ul>
<p>The function produces a vector of 3 values:</p>
<ul>
<li>the heteroscedasticity index;</li>
<li>the model standard deviation be used together with the heteroscedasticity index;</li>
<li>the <span class="math inline">\(R^{2}\)</span> of the fitted model used to estimate the two above values.</li>
</ul>
<p>A suitable number to be given to the <em>nbins</em> parameter can be found by trying different values and choosing the one with which the value of the <span class="math inline">\(R^{2}\)</span> is the highest. Experience shows that a choice of <em>nbins</em> ranging between 10 to 16 works quite well.</p>
</div>
<div id="example" class="section level1">
<h1 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h1>
<p>Consider the following example, based on the dataset <em>swissmunicipalities</em> available in the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://barcaroli.github.io/SamplingStrata">SamplingStrata</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"swissmunicipalities"</span><span class="op">)</span>
<span class="va">swissmunicipalities</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">swissmunicipalities</span><span class="op">)</span><span class="op">)</span>
<span class="va">swissmunicipalities</span><span class="op">$</span><span class="va">dom</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">swissmunicipalities</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">10</span>,<span class="fl">23</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##   REG  COM        Nom HApoly Surfacesbois Airbat POPTOT
## 1   4  261     Zurich   8781         2326   2884 363273
## 2   1 6621     Geneve   1593           67    773 177964
## 3   3 2701      Basel   2391           97   1023 166558
## 4   2  351       Bern   5162         1726   1070 128634
## 5   1 5586   Lausanne   4136         1635    856 124914
## 6   4  230 Winterthur   6787         2807    972  90483</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">swissmunicipalities</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">10</span>,<span class="fl">23</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##                 HApoly Surfacesbois    Airbat    POPTOT
## HApoly       1.0000000    0.8094731 0.2075253 0.1060809
## Surfacesbois 0.8094731    1.0000000 0.2222185 0.1056776
## Airbat       0.2075253    0.2222185 1.0000000 0.9270286
## POPTOT       0.1060809    0.1056776 0.9270286 1.0000000</code></pre>
<p>Let us assume that in the sampling frame only variables <em>total population</em> (<em>POPTOT</em>) and <em>total area</em> (<em>HApoly</em>) are available for all municipalities, while <em>buildings area</em> (<em>Airbat</em>) and <em>wooded area</em> (<em>Surfacesbois</em>) are available only on a sample of 500 municipalities.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">swiss_sample</span> <span class="op">&lt;-</span> <span class="va">swissmunicipalities</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">swissmunicipalities</span><span class="op">)</span><span class="op">)</span>,<span class="fl">500</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
<p>In this subset we can fit models between POPTOT and HAPOLY and the two variables that we assume are the target of our survey.</p>
<p>One model for <em>buildings area</em> and <em>total population</em>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_Airbat_POPTOT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">swiss_sample</span><span class="op">$</span><span class="va">Airbat</span> <span class="op">~</span> <span class="va">swiss_sample</span><span class="op">$</span><span class="va">POPTOT</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_Airbat_POPTOT</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = swiss_sample$Airbat ~ swiss_sample$POPTOT)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -143.380  -12.223   -4.391    7.336  208.728 
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         1.968e+01  1.320e+00   14.90   &lt;2e-16 ***
## swiss_sample$POPTOT 1.192e-02  2.854e-04   41.78   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 25.49 on 498 degrees of freedom
## Multiple R-squared:  0.778,  Adjusted R-squared:  0.7776 
## F-statistic:  1745 on 1 and 498 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>and one model for <em>wooded area</em> and <em>total area</em>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_Surfacesbois_HApoly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">swiss_sample</span><span class="op">$</span><span class="va">Surfacesbois</span> <span class="op">~</span> <span class="va">swiss_sample</span><span class="op">$</span><span class="va">HApoly</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_Surfacesbois_HApoly</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = swiss_sample$Surfacesbois ~ swiss_sample$HApoly)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3979.1  -152.5   -87.7    98.0  2107.3 
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         1.545e+02  1.921e+01   8.043 6.46e-15 ***
## swiss_sample$HApoly 1.997e-01  7.415e-03  26.932  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 371.1 on 498 degrees of freedom
## Multiple R-squared:  0.5929, Adjusted R-squared:  0.5921 
## F-statistic: 725.4 on 1 and 498 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>We calculate the heteroscedasticity index and associated prediction standard error for both models:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Airbat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeGamma.html">computeGamma</a></span><span class="op">(</span><span class="va">mod_Airbat_POPTOT</span><span class="op">$</span><span class="va">residuals</span>,
             <span class="va">swiss_sample</span><span class="op">$</span><span class="va">POPTOT</span>,
             nbins <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Airbat</span></code></pre></div>
<pre><code>##     gamma     sigma  r.square 
## 0.6419641 0.1220129 0.9535845</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Surfacesbois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeGamma.html">computeGamma</a></span><span class="op">(</span><span class="va">mod_Surfacesbois_HApoly</span><span class="op">$</span><span class="va">residuals</span>,
             <span class="va">swiss_sample</span><span class="op">$</span><span class="va">HApoly</span>,
             nbins <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Surfacesbois</span></code></pre></div>
<pre><code>##     gamma     sigma  r.square 
## 0.8911053 0.3582789 0.9931305</code></pre>
<p>We now proceed in building the <em>model</em> dataframe using the above models:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">model</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod_Airbat_POPTOT</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="va">model</span><span class="op">$</span><span class="va">sig2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Airbat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>
<span class="va">model</span><span class="op">$</span><span class="va">type</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"linear"</span>
<span class="va">model</span><span class="op">$</span><span class="va">gamma</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Airbat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">model</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod_Surfacesbois_HApoly</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="va">model</span><span class="op">$</span><span class="va">sig2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Surfacesbois</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>
<span class="va">model</span><span class="op">$</span><span class="va">type</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"linear"</span>
<span class="va">model</span><span class="op">$</span><span class="va">gamma</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Surfacesbois</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> 
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="va">model</span></code></pre></div>
<pre><code>##         beta       sig2   type     gamma
## 1 0.01192162 0.01488715 linear 0.6419641
## 2 0.19970325 0.12836378 linear 0.8911053</code></pre>
<p>We define the <em>sampling frame</em> in this way:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildFrameDF.html">buildFrameDF</a></span><span class="op">(</span><span class="va">swissmunicipalities</span>,
                      id <span class="op">=</span> <span class="st">"COM"</span>,
                      domainvalue <span class="op">=</span> <span class="st">"dom"</span>,
                      X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"POPTOT"</span>, <span class="st">"HApoly"</span><span class="op">)</span>,
                      Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"POPTOT"</span>, <span class="st">"HApoly"</span><span class="op">)</span><span class="op">)</span>
<span class="va">frame</span><span class="op">$</span><span class="va">Airbat</span> <span class="op">&lt;-</span> <span class="va">swissmunicipalities</span><span class="op">$</span><span class="va">Airbat</span>
<span class="va">frame</span><span class="op">$</span><span class="va">Surfacesbois</span> <span class="op">&lt;-</span> <span class="va">swissmunicipalities</span><span class="op">$</span><span class="va">Surfacesbois</span></code></pre></div>
<p>Note that the explanatory variables in the models have been set as both target variables Y and stratification variables X.</p>
<p>(Since in this exercise the true values of the variables of interest are known for each unit of the population, they have been included in the frame in order to allow a performance evaluation in the next step. It is quite clear that this knowledge is not available in real cases.)</p>
<p>We set 5% precision constraint on both variables:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>DOM<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"DOM1"</span>,<span class="fl">1</span><span class="op">)</span>,
                         CV1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">1</span><span class="op">)</span>,
                         CV2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">1</span><span class="op">)</span>,
                         domainvalue<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>
                    <span class="op">)</span><span class="op">)</span>
<span class="va">cv</span></code></pre></div>
<pre><code>##    DOM  CV1  CV2 domainvalue
## 1 DOM1 0.05 0.05           1</code></pre>
<p>We can now proceed with the optimization step:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">solution</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimStrata.html">optimStrata</a></span><span class="op">(</span>
    method <span class="op">=</span> <span class="st">"continuous"</span>,
    errors <span class="op">=</span> <span class="va">cv</span> , 
    framesamp <span class="op">=</span> <span class="va">frame</span>, 
    model <span class="op">=</span> <span class="va">model</span>,
    iter <span class="op">=</span> <span class="fl">25</span>, 
    pops <span class="op">=</span> <span class="fl">20</span>, 
    parallel <span class="op">=</span> <span class="cn">FALSE</span>,
    nStrata <span class="op">=</span> <span class="fl">5</span>,
    showPlot <span class="op">=</span> <span class="cn">FALSE</span>,
    writeFiles <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Input data have been checked and are compliant with requirements
## 
##  *** Domain :  1   1
##  Number of strata :  2896
##  *** Sample cost:  295.1979
##  *** Number of strata:  5</code></pre>
<p><img src="models_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<pre><code>## 
##  *** Sample size :  296
##  *** Number of strata :  5
## ---------------------------</code></pre>
<p>What about the expected CV’s? We attribute the real values of Airbat and Surfacesbois to the Ys of obtained <em>framenew</em> and run the simulation:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outstrata</span> <span class="op">&lt;-</span> <span class="va">solution</span><span class="op">$</span><span class="va">aggr_strata</span>
<span class="va">framenew</span> <span class="op">&lt;-</span> <span class="va">solution</span><span class="op">$</span><span class="va">framenew</span>
<span class="va">framenew</span><span class="op">$</span><span class="va">Y3</span> <span class="op">&lt;-</span> <span class="va">framenew</span><span class="op">$</span><span class="va">AIRBAT</span>
<span class="va">framenew</span><span class="op">$</span><span class="va">Y4</span> <span class="op">&lt;-</span> <span class="va">framenew</span><span class="op">$</span><span class="va">SURFACESBOIS</span>
<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evalSolution.html">evalSolution</a></span><span class="op">(</span><span class="va">framenew</span>, <span class="va">outstrata</span>, <span class="fl">500</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">results</span><span class="op">$</span><span class="va">coeff_var</span></code></pre></div>
<pre><code>##      CV1    CV2    CV3    CV4  dom
## 1 0.0369 0.0241 0.0352 0.0366 DOM1</code></pre>
<p>The first two CVs pertain to the proxy available variables, namely <em>total population</em> and <em>total area</em>, while the last two regard respectively <em>buildings area</em> and <em>wooded area</em>: they are more than compliant with the precision constraint of 5%.</p>
<p>What if we did not use the information contained in models? We run the same optimization step without indicating any model parameter:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">solution</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimStrata.html">optimStrata</a></span><span class="op">(</span>
    method <span class="op">=</span> <span class="st">"continuous"</span>,
    errors <span class="op">=</span> <span class="va">cv</span> , 
    framesamp <span class="op">=</span> <span class="va">frame</span>, 
    model <span class="op">=</span> <span class="cn">NULL</span>,
    iter <span class="op">=</span> <span class="fl">25</span>, 
    pops <span class="op">=</span> <span class="fl">20</span>, 
    parallel <span class="op">=</span> <span class="cn">FALSE</span>,
    nStrata <span class="op">=</span> <span class="fl">5</span>,
    showPlot <span class="op">=</span> <span class="cn">FALSE</span>,
    writeFiles <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Input data have been checked and are compliant with requirements
## 
##  *** Domain :  1   1
##  Number of strata :  2896
##  *** Sample cost:  151.9848
##  *** Number of strata:  5</code></pre>
<p><img src="models_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<pre><code>## 
##  *** Sample size :  152
##  *** Number of strata :  5
## ---------------------------</code></pre>
<p>We obtain a solution that requires a much lower sample size to satisfy the precision constraints on the Ys. But as we did not consider the anticipated variance on the real target variables, we pay a price in terms of expected CVs on them:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outstrata</span> <span class="op">&lt;-</span> <span class="va">solution</span><span class="op">$</span><span class="va">aggr_strata</span>
<span class="va">framenew</span> <span class="op">&lt;-</span> <span class="va">solution</span><span class="op">$</span><span class="va">framenew</span>
<span class="va">framenew</span><span class="op">$</span><span class="va">Y3</span> <span class="op">&lt;-</span> <span class="va">framenew</span><span class="op">$</span><span class="va">AIRBAT</span>
<span class="va">framenew</span><span class="op">$</span><span class="va">Y4</span> <span class="op">&lt;-</span> <span class="va">framenew</span><span class="op">$</span><span class="va">SURFACESBOIS</span>
<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evalSolution.html">evalSolution</a></span><span class="op">(</span><span class="va">framenew</span>, <span class="va">outstrata</span>, <span class="fl">500</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">results</span><span class="op">$</span><span class="va">coeff_var</span></code></pre></div>
<pre><code>##      CV1    CV2    CV3    CV4  dom
## 1 0.0501 0.0491 0.0502 0.0686 DOM1</code></pre>
<p>Norwithstanding the non inclusion of the models in the optimization step, the CV related to <em>buildings area</em> is still inside the limit of the 5%: this is most likely due to the high correlation between <em>buildings area</em> and <em>total population</em>. While the lower correlation between the <em>total area</em> and <em>woods area</em> determines the non compliance of the expected CV of <em>woods area</em> that was instead guaranted using the related model.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-baillargeon2014" class="csl-entry">
Baillargeon, Sophie, and Louis-Paul Rivest. 2014. <em>Stratification: Univariate Stratification of Survey Populations</em>. <a href="https://CRAN.R-project.org/package=stratification">https://CRAN.R-project.org/package=stratification</a>.
</div>
<div id="ref-henry2006" class="csl-entry">
Henry, K., and R. Valliant. 2006. <span>“<span class="nocase">Comparing Strategies to Estimate a Measure of Heteroscedasticity</span>.”</span>
</div>
<div id="ref-knaub2019" class="csl-entry">
Knaub, J. R. 2019. <span>“<span class="nocase">Estimating the Coefficient of Heteroscedasticity</span>.”</span>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Giulio Barcaroli, Marco Ballin, Hanjo Odendaal, Daniela Pagliuca, Egon Willighagen, Diego Zardetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
